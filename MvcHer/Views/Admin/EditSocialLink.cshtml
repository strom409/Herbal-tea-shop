@model MvcHer.Models.SocialLink

@{
    ViewData["Title"] = Model.Id == 0 ? "Add New Social Link" : "Edit Social Link";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="fas fa-@(Model.Id == 0 ? "plus" : "edit") me-2"></i>
                    @ViewData["Title"]
                </h2>
                <a href="@Url.Action("SocialLinks")" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Social Links
                </a>
            </div>

            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    @TempData["ErrorMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Social Link Information</h5>
                </div>
                <div class="card-body">
                    <form asp-action="EditSocialLink" method="post" id="socialLinkForm">
                        @Html.AntiForgeryToken()
                        <input asp-for="Id" type="hidden" />
                        <input asp-for="CreatedAt" type="hidden" />

                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0">Basic Information</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label asp-for="Platform" class="form-label">
                                                <i class="fas fa-tag me-1"></i>Platform *
                                            </label>
                                            <select asp-for="Platform" class="form-select" required onchange="updatePlatformDefaults()">
                                                <option value="">Select Platform</option>
                                                <option value="Facebook">Facebook</option>
                                                <option value="Twitter">Twitter</option>
                                                <option value="Instagram">Instagram</option>
                                                <option value="LinkedIn">LinkedIn</option>
                                                <option value="YouTube">YouTube</option>
                                                <option value="TikTok">TikTok</option>
                                                <option value="Pinterest">Pinterest</option>
                                                <option value="WhatsApp">WhatsApp</option>
                                                <option value="Telegram">Telegram</option>
                                                <option value="Other">Other</option>
                                            </select>
                                            <span asp-validation-for="Platform" class="text-danger"></span>
                                        </div>

                                        <div class="mb-3">
                                            <label asp-for="DisplayName" class="form-label">
                                                <i class="fas fa-signature me-1"></i>Display Name *
                                            </label>
                                            <input asp-for="DisplayName" class="form-control" placeholder="e.g., Herbal Tea Facebook" required />
                                            <span asp-validation-for="DisplayName" class="text-danger"></span>
                                            <small class="form-text text-muted">This will be shown as tooltip text</small>
                                        </div>

                                        <div class="mb-3">
                                            <label asp-for="Url" class="form-label">
                                                <i class="fas fa-link me-1"></i>URL *
                                            </label>
                                            <input asp-for="Url" type="url" class="form-control" placeholder="https://facebook.com/yourpage" required />
                                            <span asp-validation-for="Url" class="text-danger"></span>
                                            <small class="form-text text-muted">Full URL including https://</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Styling & Display -->
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0">Styling & Display</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label asp-for="IconClass" class="form-label">
                                                <i class="fas fa-icons me-1"></i>Icon Class
                                            </label>
                                            <input asp-for="IconClass" class="form-control" placeholder="fab fa-facebook-f" />
                                            <span asp-validation-for="IconClass" class="text-danger"></span>
                                            <small class="form-text text-muted">FontAwesome icon class (e.g., fab fa-facebook-f)</small>
                                        </div>

                                        <div class="mb-3">
                                            <label asp-for="Color" class="form-label">
                                                <i class="fas fa-palette me-1"></i>Brand Color
                                            </label>
                                            <div class="input-group">
                                                <input asp-for="Color" type="color" class="form-control form-control-color" style="width: 60px;" />
                                                <input asp-for="Color" type="text" class="form-control" placeholder="#1877F2" />
                                            </div>
                                            <span asp-validation-for="Color" class="text-danger"></span>
                                            <small class="form-text text-muted">Brand color for the platform</small>
                                        </div>

                                        <div class="mb-3">
                                            <label asp-for="DisplayOrder" class="form-label">
                                                <i class="fas fa-sort-numeric-up me-1"></i>Display Order
                                            </label>
                                            <input asp-for="DisplayOrder" type="number" class="form-control" min="0" max="100" />
                                            <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                                            <small class="form-text text-muted">Lower numbers appear first (0-100)</small>
                                        </div>

                                        <!-- Preview -->
                                        <div class="mb-3">
                                            <label class="form-label">
                                                <i class="fas fa-eye me-1"></i>Preview
                                            </label>
                                            <div class="border rounded p-3 bg-light">
                                                <div id="iconPreview" class="d-flex align-items-center">
                                                    <i id="previewIcon" class="@Model.IconClass me-2" style="color: @Model.Color; font-size: 1.5em;"></i>
                                                    <span id="previewText">@Model.DisplayName</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Status Settings -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="mb-0">Status Settings</h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check form-switch">
                                    <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                    <label asp-for="IsActive" class="form-check-label">
                                        <i class="fas fa-toggle-on me-1"></i>Active
                                    </label>
                                    <small class="form-text text-muted d-block">Show this social link on the website</small>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="@Url.Action("SocialLinks")" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-success" id="submitBtn">
                                <i class="fas fa-save me-2"></i>
                                <span id="submitText">@(Model.Id == 0 ? "Create Social Link" : "Update Social Link")</span>
                                <span id="submitSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Platform defaults
const platformDefaults = {
    'Facebook': { icon: 'fab fa-facebook-f', color: '#1877F2' },
    'Twitter': { icon: 'fab fa-twitter', color: '#1DA1F2' },
    'Instagram': { icon: 'fab fa-instagram', color: '#E4405F' },
    'LinkedIn': { icon: 'fab fa-linkedin-in', color: '#0077B5' },
    'YouTube': { icon: 'fab fa-youtube', color: '#FF0000' },
    'TikTok': { icon: 'fab fa-tiktok', color: '#000000' },
    'Pinterest': { icon: 'fab fa-pinterest', color: '#BD081C' },
    'WhatsApp': { icon: 'fab fa-whatsapp', color: '#25D366' },
    'Telegram': { icon: 'fab fa-telegram', color: '#0088CC' }
};

function updatePlatformDefaults() {
    const platform = document.querySelector('[name="Platform"]').value;
    const iconInput = document.querySelector('[name="IconClass"]');
    const colorInput = document.querySelector('[name="Color"]');
    const displayNameInput = document.querySelector('[name="DisplayName"]');
    
    if (platform && platformDefaults[platform]) {
        const defaults = platformDefaults[platform];
        
        // Only update if fields are empty
        if (!iconInput.value) {
            iconInput.value = defaults.icon;
        }
        if (!colorInput.value) {
            colorInput.value = defaults.color;
        }
        if (!displayNameInput.value) {
            displayNameInput.value = `Herbal Tea ${platform}`;
        }
        
        updatePreview();
    }
}

function updatePreview() {
    const iconClass = document.querySelector('[name="IconClass"]').value;
    const color = document.querySelector('[name="Color"]').value;
    const displayName = document.querySelector('[name="DisplayName"]').value;
    
    const previewIcon = document.getElementById('previewIcon');
    const previewText = document.getElementById('previewText');
    
    previewIcon.className = iconClass || 'fas fa-link';
    previewIcon.style.color = color || '#666';
    previewText.textContent = displayName || 'Social Link';
}

// Update preview on input changes
document.addEventListener('DOMContentLoaded', function() {
    const inputs = ['IconClass', 'Color', 'DisplayName'];
    inputs.forEach(name => {
        const input = document.querySelector(`[name="${name}"]`);
        if (input) {
            input.addEventListener('input', updatePreview);
        }
    });
    
    // Initial preview update
    updatePreview();
});

// Form submission handling
document.getElementById('socialLinkForm').addEventListener('submit', function() {
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitSpinner = document.getElementById('submitSpinner');
    
    submitBtn.disabled = true;
    submitText.textContent = 'Saving...';
    submitSpinner.style.display = 'inline-block';
});

// Auto-dismiss alerts
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
});
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
